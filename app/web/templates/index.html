{% extends "base.html" %}

{% block content %}

<div class='container mt-4'>
<h2>Product List</h2>

<div id="productContainer">
    <p>Loading products...</p>
</div>

<script>
async function fetchProducts() {
    try {
        let response = await fetch("/api/products/list");  // Fetch from API
        let products = await response.json();

        let productContainer = document.getElementById("productContainer");
        productContainer.innerHTML = "";  // Clear loading text

        if (products.length === 0) {
            productContainer.innerHTML = "<p>No products found.</p>";
            return;
        }

        products.forEach(product => {
            let productCard = document.createElement("div");
            productCard.classList.add("product-card");
            productCard.classList.add("card");

            console.log(product.image_urls)
            
            let imageUrl = ''
            if (product.image_urls) {
                imageUrl = product.image_urls.length > 0 ? product.image_urls[0] : "/static/no-image.png";
            } else {
                imageUrl = "static/no-image.png";
            }
            
            productCard.innerHTML = `
            <img src="/${product.image_urls[0]}" alt="Product Image" class="card-img-top">
            <div class="card-body">
            <h5 class="card-title">${product.name}</h3>
            <p class="card-text">${product.description}</p>
            <p class="">Price: $${product.price.toFixed(2)}</p>
            <p>Category: ${product.category}</p>
            </div>

            `;

            productContainer.appendChild(productCard);
        });

    } catch (error) {
        console.error("Error fetching products:", error);
        document.getElementById("productContainer").innerHTML = "<p>Error loading products.</p>";
    }
}

// Load products when the page loads
fetchProducts();
</script>

</div>
{% endblock %}
