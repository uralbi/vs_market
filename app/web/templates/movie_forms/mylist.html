
    <div id="movies-list" class=""></div>

    <script>

        async function fetchMyMovies() {
                const token = getAccessTokenFromCookie();
                if (!token) {  return; }

                try {
                    const response = await fetch("api/movies/my", {
                        method: "GET",
                        headers: { "Authorization": `Bearer ${token}` }
                    });

                    if (!response.ok) {
                        error = await response.json();
                    }
                    const movies = await response.json();
                    displayListMovies(movies);
                    
                } catch (error) {
                    document.getElementById("movies-list").innerHTML = `
                    <div class="card p-3 mb-3">
                    <div class="d-flex align-items-center justify-content-between">
                            <div>
                                <h6 class="mb-1">У вас нет загруженных фильмов</h6>
                            </div>
                        </div>
                    </div>
                    `
                } 
        }

        function displayListMovies(movies) {
            const moviesList = document.getElementById("movies-list");
            moviesList.innerHTML = ""; // Clear existing list
        
            if (movies.length === 0) {
                moviesList.textContent = "No movies found.";
                return;
                }

            movies.forEach(movie => {
                const movieCard = document.createElement("div");
                movieCard.classList.add("card", "shadow-sm", "mb-1", "p-1", "border-0");
        
                movieCard.innerHTML = `
                    <div class="row btn-group d-flex justify-content-between">
                        <div class="col-md-5 d-flex align-items-center justify-content-between">
                            <div>
                                <h2 class="fs-5 m-0">${movie.title}</h2>
                                <small class="text-muted m-0"> Создан: ${formatTimestamp(movie.created_at)} </small>
                            </div>
                            <span class="badge bg-success px-3 ms-3">${movie.price} сом</span>
                        </div>
                        <div class="col-md-5 d-flex justify-content-end">
                        <a class="btn btn-outline-success" href="/movies/stream?id=${movie.id}"><i class="bi bi-play-btn"></i></a>
                        <a class="btn btn-outline-primary" href="/movies/update?id=${movie.id}"><i class="bi bi-pencil-square"></i></a>
                        <a role="button" class="btn btn-outline-danger" onclick="Delete_movie_btn(${movie.id})"><i class="bi bi-x-square"></i></a>
                        </div>
                    </div>
                `;
        
                moviesList.appendChild(movieCard);
            });
        }
        

        async function Delete_movie_btn(movieId, button) {


            showConfirmationModal("Подтвердите удаление Видео", async () => {  
        
                const token = getAccessTokenFromCookie(); // Get auth token
                if (!token) {
                    showMessage("Вы не авторизованы", "warning")
                    return; }
            
                try {
                    const response = await fetch(`api/movies/${movieId}`, {
                        method: "DELETE",
                        headers: { "Authorization": `Bearer ${token}` }
                    });
            
                    if (!response.ok) {
                        let error = await response.json()
                        showMessage(error.detail, "danger")
                    } else {
                        showMessage("Фильм удален", "success")
                        setTimeout(() => {
                            window.location.reload();
                        }, 2000);
                    }
                    
                } catch (error) {
                    console.log("error in deletion:", error.message)
                    showMessage(error.message, "warning")
                }
            });
        }

        document.addEventListener("DOMContentLoaded", fetchMyMovies);
    </script>